<!DOCTYPE html>
<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
  <title>Polyglot Audiobook Generator</title> 
  <link rel="stylesheet" href="assets/styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HP6ZDS0E04"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-HP6ZDS0E04');
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="assets/lib/jszip.min.js"></script> 
  <script src="assets/lib/FileSaver.min.js"></script> 

  <!-- Updated JS paths and order -->
  <!-- Data and Config first -->
  <script src="assets/config.js" defer></script>
  <script src="assets/static/language_data.js" defer></script>
  <script src="assets/ui_translations.js" defer></script>
  <script src="assets/static/voices-data.js" defer></script> <!-- ADDED -->
  <!-- Utilities and API -->
  <script src="assets/translation_utils.js" defer></script>
  <script src="assets/translation_api.js" defer></script>
  <script src="assets/epub_generator.js" defer></script>
  <script src="assets/texts_converter.js" defer></script>
  <!-- UI Helper Functions -->
  <script src="assets/ui_helpers.js" defer></script>
  <!-- Settings and Help System -->
  <script src="assets/settings.js" defer></script> <!-- ADDED -->
  <script src="assets/help_system.js" defer></script> <!-- ADDED -->
  <!-- Progress Bar Logic -->
  <script src="assets/progress_bar.js" defer></script>
  <!-- Language Dropdown Creation -->
  <script src="assets/language_dropdown.js" defer></script>
  <!-- UI Logic -->
  <script src="assets/ui.js" defer></script>
  <!-- Voice Dropdown Logic -->
  <script src="assets/voice-dropdown-menu.js" defer></script>
  <!-- EdgeTTS specific JS -->
  <script src="assets/processing_file.js" defer></script>
  <script src="assets/socket_edge_tts.js" defer></script>
  <!-- Audio Generation Logic -->
  <script src="assets/audio_helpers.js" defer></script>
  <!-- Single Language Audio Logic -->
  <script src="assets/audio_single_language.js" defer></script> <!-- ADDED HERE -->
  <!-- Multi-Language Audio Logic -->
  <script src="assets/audio_multi_language.js" defer></script> <!-- ADDED HERE -->
  <!-- Bilingual Views Logic -->
  <script src="assets/bilingual_view_generator.js" defer></script> <!-- ADDED HERE -->
  <!-- Core Application Logic (decides which generation to run) -->
  <script src="assets/app_logic.js" defer></script>
  <!-- Event Listeners -->
  <script src="assets/event_listeners.js" defer></script>
  <!-- Initialization Logic -->
  <script src="assets/initialization.js" defer></script>
  <!-- Main orchestration script last -->
  <script src="assets/main.js" defer></script>

  <!-- Removed old script tags for languages.js and translations.js -->
</head>

<body>
  <!-- START: Firefox Warning Message (Hidden by default) -->
  <div id="firefox-warning" class="hide"
    style="background-color: #ffdddd; border: 1px solid #f44336; color: #a94442; padding: 15px; margin: 10px; text-align: center; border-radius: 5px; font-size: 0.9em;">
    <strong>Notice:</strong> This application currently experiences issues in Firefox due to browser-specific
    restrictions on accessing translation services. For the best experience, please use Google Chrome or another
    Chromium-based browser.
  </div>
  <!-- END: Firefox Warning Message -->

  <div class="del">
    <header>
      <h1>Polyglot Audiobook Generator</h1> <!-- Updated Title -->
      <div id="language-selector-container">
        <button class="settings-button" id="settings-button" title="Settings">‚öôÔ∏è</button>
        <label id="ui-language-label" for="ui-language-selector">
          <span id="ui-language-icon">üåê</span>
          <span>UI Language:</span> <!-- Initial text, updated by JS -->
        </label>
        <!-- UI Language selector will be added here by JavaScript -->
      </div>
    </header>
    <div id="language-headers" class="language-row-headers">
      <span class="header-spacer header-label-spacer"></span> <!-- Spacer for the main label column -->
      <span id="header-language-label" class="header-label header-language-col">Language</span>
      <!-- Placeholder text -->
      <span id="header-voice-label" class="header-label header-voice-col">Voice Selection</span>
      <!-- Placeholder text -->
      <span class="header-spacer header-controls-spacer"></span> <!-- Spacer for voice controls -->
      <span class="header-spacer header-buttons-spacer"></span> <!-- Spacer for add/remove buttons -->
    </div>

    <div id="sl-container">
      <label for="sl">Source Language:</label> <!--This will be translated-->
      <!-- Language select added by JS -->
      <select id="sl-voice" class="voice-select"></select>
      <!-- Voice Controls Added -->
      <div class="voice-controls">
        <div class="slider-container">
          <label for="sl-rate">Rate:</label>
          <input type="range" id="sl-rate" class="rate-slider" min="-100" max="100" value="0">
          <span class="rate-value">+0%</span>
        </div>
        <div class="slider-container">
          <label for="sl-pitch">Pitch:</label>
          <input type="range" id="sl-pitch" class="pitch-slider" min="-50" max="50" value="0">
          <span class="pitch-value">+0Hz</span>
        </div>
      </div>
      <!-- End Voice Controls -->
      <!-- ADDED: Button to add the first target language -->
      <button id="add-first-target-button" class="add-lang-button">+</button>
    </div>

    <!-- MODIFIED: Target Language 1 container is hidden by default -->
    <div id="tl1-container" class="hide">
      <label for="tl1">Target Language 1:</label> <!--This will be translated-->
      <!-- Language select added by JS -->
      <select id="tl1-voice" class="voice-select"></select> <!-- ADDED Voice Dropdown Placeholder -->
      <!-- MODIFIED: Removed onclick, will be handled by JS listener -->
      <button class="add-lang-button" data-target-container-id="tl2-container">+</button>
      <!-- ADDED: Remove button for TL1 -->
      <button class="remove-lang-button" data-target-container-id="tl1-container">-</button>
      <!-- Voice Controls Added -->
      <div class="voice-controls">
        <div class="slider-container">
          <label for="tl1-rate">Rate:</label>
          <input type="range" id="tl1-rate" class="rate-slider" min="-100" max="100" value="0">
          <span class="rate-value">+0%</span>
        </div>
        <div class="slider-container">
          <label for="tl1-pitch">Pitch:</label>
          <input type="range" id="tl1-pitch" class="pitch-slider" min="-50" max="50" value="0">
          <span class="pitch-value">+0Hz</span>
        </div>
      </div>
      <!-- End Voice Controls -->
    </div>

    <div id="tl2-container" class="hide">
      <label for="tl2">Target Language 2:</label> <!--This will be translated-->
      <!-- Language select added by JS -->
      <select id="tl2-voice" class="voice-select"></select> <!-- ADDED Voice Dropdown Placeholder -->
      <!-- MODIFIED: Removed onclick, will be handled by JS listener -->
      <button class="add-lang-button" data-target-container-id="tl3-container">+</button>
      <!-- MODIFIED: Removed onclick, will be handled by JS listener -->
      <button class="remove-lang-button" data-target-container-id="tl2-container">-</button>
      <!-- Voice Controls Added -->
      <div class="voice-controls">
        <div class="slider-container">
          <label for="tl2-rate">Rate:</label>
          <input type="range" id="tl2-rate" class="rate-slider" min="-100" max="100" value="0">
          <span class="rate-value">+0%</span>
        </div>
        <div class="slider-container">
          <label for="tl2-pitch">Pitch:</label>
          <input type="range" id="tl2-pitch" class="pitch-slider" min="-50" max="50" value="0">
          <span class="pitch-value">+0Hz</span>
        </div>
      </div>
      <!-- End Voice Controls -->
    </div>

    <div id="tl3-container" class="hide">
      <label for="tl3">Target Language 3:</label> <!--This will be translated-->
      <!-- Language select added by JS -->
      <select id="tl3-voice" class="voice-select"></select> <!-- ADDED Voice Dropdown Placeholder -->
      <!-- MODIFIED: Removed onclick, will be handled by JS listener -->
      <button class="add-lang-button" data-target-container-id="tl4-container">+</button>
      <!-- MODIFIED: Removed onclick, will be handled by JS listener -->
      <button class="remove-lang-button" data-target-container-id="tl3-container">-</button>
      <!-- Voice Controls Added -->
      <div class="voice-controls">
        <div class="slider-container">
          <label for="tl3-rate">Rate:</label>
          <input type="range" id="tl3-rate" class="rate-slider" min="-100" max="100" value="0">
          <span class="rate-value">+0%</span>
        </div>
        <div class="slider-container">
          <label for="tl3-pitch">Pitch:</label>
          <input type="range" id="tl3-pitch" class="pitch-slider" min="-50" max="50" value="0">
          <span class="pitch-value">+0Hz</span>
        </div>
      </div>
      <!-- End Voice Controls -->
    </div>

    <div id="tl4-container" class="hide">
      <label for="tl4">Target Language 4:</label> <!--This will be translated-->
      <!-- Language select added by JS -->
      <select id="tl4-voice" class="voice-select"></select> <!-- ADDED Voice Dropdown Placeholder -->
      <!-- MODIFIED: Removed onclick, will be handled by JS listener -->
      <button class="remove-lang-button" data-target-container-id="tl4-container">-</button>
      <!-- Voice Controls Added -->
      <div class="voice-controls">
        <div class="slider-container">
          <label for="tl4-rate">Rate:</label>
          <input type="range" id="tl4-rate" class="rate-slider" min="-100" max="100" value="0">
          <span class="rate-value">+0%</span>
        </div>
        <div class="slider-container">
          <label for="tl4-pitch">Pitch:</label>
          <input type="range" id="tl4-pitch" class="pitch-slider" min="-50" max="50" value="0">
          <span class="pitch-value">+0Hz</span>
        </div>
      </div>
      <!-- End Voice Controls -->
    </div>

    <!-- ADDED: Container for Advanced Audio Settings, hidden by default -->
    <div id="advanced-audio-settings" class="hide" style="margin-top: 15px; margin-bottom: 15px; border: 1px dashed #ccc; padding: 15px; border-radius: 5px;">
       <h4 style="margin-bottom: 10px; color: #555;">Advanced Audio Settings</h4> <!-- Added heading -->
       <!-- Reusing slider-container class for layout -->
       <div class="slider-container" id="div-threads"> <!-- Added ID for consistency -->
        <label for="max-threads" style="flex-basis: 70px;">Threads:</label> <!-- Adjusted label width -->
        <!-- Ensure class="max-threads" and id="max-threads" are present -->
        <input type="range" id="max-threads" class="max-threads" min="1" max="30" value="10" step="1" style="flex-grow: 1;">
        <!-- Ensure class="threads-value" and id="max-threads-int" are present -->
        <span class="threads-value" id="max-threads-int" style="min-width: 30px; text-align: right;">10</span> <!-- Adjusted width -->
      </div>
      <div class="slider-container" id="div-mergefiles" style="margin-top: 5px;"> <!-- Added ID for consistency -->
        <label for="mergefiles" style="flex-basis: 70px;">Merge by:</label> <!-- Adjusted label width -->
        <!-- Ensure class="mergefiles" and id="mergefiles" are present -->
        <input type="range" id="mergefiles" class="mergefiles" min="1" max="100" value="100" step="1" style="flex-grow: 1;">
        <!-- Ensure class="merge-value" and id="mergefiles-str" are present -->
        <span class="merge-value" id="mergefiles-str" style="min-width: 50px; text-align: right;">ALL</span> <!-- Adjusted width -->
      </div>
    </div>

    <br>
    <h3>Enter source text:</h3>
    <textarea id="source-text" placeholder="Enter your source text here..."></textarea>
    <!-- Hidden file input -->
    <input type="file" id="file-input" accept=".txt, .fb2, .epub, .ini, .zip" multiple style="display: none;">
    <!-- Button to trigger file input -->
    <button id="insert-file-button" style="margin-right: 10px;">Insert Text File</button> <!-- Placeholder text -->
    <button id="generate-button">Generate</button> 
    <!-- Moved Post-Translation Buttons Here -->
    <button id="open-book-view-button" class="hide" style="margin-left: 10px;">Open in Book-View</button>
    <button id="save-epub-button" class="hide" style="margin-left: 5px;">Save as EPUB</button>
    <button id="reload-page-button" class="hide" style="margin-left: 5px;">Reload Page</button>

    <!-- Progress Bar -->
    <div id="progress-container" style="margin-top: 20px; display: none;"> <!-- Added margin-top, hidden initially -->
      <div id="progress-bar">0%</div>
    </div>
    <div id="progress-info" style="display: none;"> <!-- Hidden initially -->
      <span>Translated: 0 / 0</span> | <!--This will be translated-->
      <span>ETA: Calculating...</span> <!--This will be translated-->
    </div>
    <!-- Moved Translation Finished Message Here -->
    <div id="translation-finished-message" class="hide" style="margin-top: 10px; font-weight: bold;">Translation
      process
      over.</div>

    <!-- Status Text Area (Hidden by default) -->
    <textarea readonly class="text hide" id="stat-area" style="margin-top: 10px; height: 150px; background-color: #f0f0f0; border: 1px solid #ccc; color: #333; font-family: monospace; font-size: 0.9em;" placeholder="Audio generation status will appear here..."></textarea>

  </div>
  <div id="output"></div> <!-- Used for bilingual book output -->

</body>

</html>